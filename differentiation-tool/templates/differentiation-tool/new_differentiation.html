{% extends "differentiation-tool/base.html" %}

{% block title %}New Differentiation - DiffF{% endblock %}

{% block content %}
<div class="container">
    <div class="card card-accent">
        <h1 class="card-title">Differentiate a New Lesson</h1>
        <p class="card-subtitle">Phase 1: Input your lesson material and select students</p>

        <div class="phase-indicator">
            <div class="phase-step active">
                <div class="phase-circle">1</div>
                <div class="phase-label">Input</div>
            </div>
            <div class="phase-step">
                <div class="phase-circle">2</div>
                <div class="phase-label">Suggestions</div>
            </div>
            <div class="phase-step">
                <div class="phase-circle">3</div>
                <div class="phase-label">Refine</div>
            </div>
            <div class="phase-step">
                <div class="phase-circle">4</div>
                <div class="phase-label">Generate</div>
            </div>
        </div>

        <form method="POST" data-validate>
            <div class="form-group">
                <label for="title" class="form-label">Lesson Title *</label>
                <input type="text" id="title" name="title" class="form-control"
                       placeholder="e.g., OOP Project: Design a 'Pet' class" required>
            </div>

            <div class="form-group">
                <label for="material" class="form-label">Original Lesson Material *</label>
                <textarea id="material" name="material" class="form-control" rows="10" required
                          placeholder="Paste your lesson, assignment, or activity here..."></textarea>
                <small class="text-muted">Include instructions, learning objectives, and any relevant details</small>
            </div>

            <div class="form-group">
                <label class="form-label">Select Students *</label>
                {% if students %}
                <div style="max-height: 250px; overflow-y: auto; border: 2px solid var(--border-light); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                    {% for student in students %}
                    <div class="form-check">
                        <input type="checkbox" id="student_{{ student['id'] }}" name="students"
                               value="{{ student['id'] }}" class="form-check-input">
                        <label for="student_{{ student['id'] }}" class="form-check-label">
                            {{ student['first_name'] }} {{ student['last_name'] }}
                            {% if student['accommodations'] %}
                            <span class="text-muted" style="font-size: 0.85rem;">- {{ student['accommodations'][:40] }}{% if student['accommodations']|length > 40 %}...{% endif %}</span>
                            {% endif %}
                        </label>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">You need to add students first.
                    <a href="{{ url_for('differentiation.add_student') }}">Add a student</a>
                </p>
                {% endif %}
            </div>

            {% if groups %}
            <div class="form-group">
                <label class="form-label">Or Select Groups</label>
                <div style="border: 2px solid var(--border-light); border-radius: 8px; padding: 1rem;">
                    {% for group in groups %}
                    <div class="form-check">
                        <input type="checkbox" id="group_{{ group['id'] }}" name="groups"
                               value="{{ group['id'] }}" class="form-check-input">
                        <label for="group_{{ group['id'] }}" class="form-check-label">
                            {{ group['name'] }}
                            <span class="text-muted" style="font-size: 0.85rem;">({{ group['member_count'] }} students)</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="btn-group">
                <button type="submit" class="btn btn-primary">Continue to Suggestions â†’</button>
                <a href="{{ url_for('differentiation.dashboard') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
